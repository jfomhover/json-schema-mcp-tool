{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://voices-from-the-archive.com/schemas/book.json",
  "title": "Book Schema",
  "description": "JSON schema for digitized book content with metadata, chapters, and annotations",
  "type": "object",
  "required": ["metadata", "content"],
  "properties": {
    "metadata": {
      "type": "object",
      "description": "Book metadata and bibliographic information",
      "required": ["title", "author"],
      "properties": {
        "title": {
          "type": "string",
          "description": "The main title of the book",
          "minLength": 1
        },
        "subtitle": {
          "type": "string",
          "description": "The subtitle of the book, if any"
        },
        "author": {
          "oneOf": [
            {
              "type": "string",
              "description": "Single author name"
            },
            {
              "type": "array",
              "description": "Multiple authors",
              "items": {
                "type": "string"
              },
              "minItems": 1
            }
          ]
        },
        "editor": {
          "oneOf": [
            {
              "type": "string",
              "description": "Single editor name"
            },
            {
              "type": "array",
              "description": "Multiple editors",
              "items": {
                "type": "string"
              },
              "minItems": 1
            }
          ]
        },
        "translator": {
          "oneOf": [
            {
              "type": "string",
              "description": "Single translator name"
            },
            {
              "type": "array",
              "description": "Multiple translators",
              "items": {
                "type": "string"
              },
              "minItems": 1
            }
          ]
        },
        "publisher": {
          "type": "string",
          "description": "Publisher name"
        },
        "publicationYear": {
          "type": "integer",
          "description": "Year of publication",
          "minimum": 1000,
          "maximum": 2100
        },
        "publicationPlace": {
          "type": "string",
          "description": "City or location of publication"
        },
        "edition": {
          "type": "string",
          "description": "Edition information (e.g., '2nd edition', 'revised edition')"
        },
        "isbn": {
          "type": "string",
          "description": "ISBN identifier",
          "pattern": "^(97[89])?[0-9]{9}[0-9X]$"
        },
        "language": {
          "type": "string",
          "description": "Primary language of the book (ISO 639-1 code)",
          "pattern": "^[a-z]{2}$"
        },
        "subjects": {
          "type": "array",
          "description": "Subject classifications or keywords",
          "items": {
            "type": "string"
          }
        },
        "genre": {
          "type": "string",
          "description": "Literary genre or category"
        },
        "pages": {
          "type": "integer",
          "description": "Total number of pages",
          "minimum": 1
        },
        "series": {
          "type": "object",
          "description": "Series information if part of a series",
          "properties": {
            "title": {
              "type": "string",
              "description": "Series title"
            },
            "volume": {
              "type": "integer",
              "description": "Volume number in series",
              "minimum": 1
            }
          }
        },
        "digitization": {
          "type": "object",
          "description": "Information about the digitization process",
          "properties": {
            "date": {
              "type": "string",
              "format": "date",
              "description": "Date when digitization was completed"
            },
            "source": {
              "type": "string",
              "description": "Institution or library that provided the source"
            },
            "method": {
              "type": "string",
              "description": "Digitization method or technology used"
            },
            "quality": {
              "type": "string",
              "enum": ["low", "medium", "high"],
              "description": "Overall quality of the digitization"
            }
          }
        },
        "rights": {
          "type": "object",
          "description": "Copyright and usage rights information",
          "properties": {
            "copyright": {
              "type": "string",
              "description": "Copyright status"
            },
            "license": {
              "type": "string",
              "description": "License under which the work is available"
            },
            "publicDomain": {
              "type": "boolean",
              "description": "Whether the work is in the public domain"
            }
          }
        }
      }
    },
    "content": {
      "type": "object",
      "description": "The actual content structure of the book",
      "required": ["chapters"],
      "properties": {
        "frontMatter": {
          "type": "array",
          "description": "Front matter sections (preface, introduction, etc.)",
          "items": {
            "$ref": "#/$defs/section"
          }
        },
        "chapters": {
          "type": "array",
          "description": "Main chapters of the book",
          "items": {
            "$ref": "#/$defs/chapter"
          },
          "minItems": 1
        },
        "backMatter": {
          "type": "array",
          "description": "Back matter sections (appendices, bibliography, index, etc.)",
          "items": {
            "$ref": "#/$defs/section"
          }
        }
      }
    }
  },
  "$defs": {
    "chapter": {
      "type": "object",
      "description": "A book chapter with title and content",
      "required": ["title", "content"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the chapter"
        },
        "number": {
          "type": "integer",
          "description": "Chapter number",
          "minimum": 1
        },
        "title": {
          "type": "string",
          "description": "Chapter title",
          "minLength": 1
        },
        "subtitle": {
          "type": "string",
          "description": "Chapter subtitle, if any"
        },
        "pageRange": {
          "$ref": "#/$defs/pageRange"
        },
        "content": {
          "type": "array",
          "description": "Chapter content as sections or paragraphs",
          "items": {
            "oneOf": [
              {
                "$ref": "#/$defs/section"
              },
              {
                "$ref": "#/$defs/paragraph"
              }
            ]
          },
          "minItems": 1
        },
        "notes": {
          "type": "array",
          "description": "Chapter-level notes or annotations",
          "items": {
            "$ref": "#/$defs/note"
          }
        }
      }
    },
    "section": {
      "type": "object",
      "description": "A section within a chapter or as front/back matter",
      "required": ["title", "content"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the section"
        },
        "title": {
          "type": "string",
          "description": "Section title",
          "minLength": 1
        },
        "subtitle": {
          "type": "string",
          "description": "Section subtitle, if any"
        },
        "level": {
          "type": "integer",
          "description": "Hierarchical level of the section (1=top level, 2=subsection, etc.)",
          "minimum": 1,
          "maximum": 6
        },
        "pageRange": {
          "$ref": "#/$defs/pageRange"
        },
        "content": {
          "type": "array",
          "description": "Section content as subsections or paragraphs",
          "items": {
            "oneOf": [
              {
                "$ref": "#/$defs/section"
              },
              {
                "$ref": "#/$defs/paragraph"
              }
            ]
          },
          "minItems": 1
        },
        "notes": {
          "type": "array",
          "description": "Section-level notes or annotations",
          "items": {
            "$ref": "#/$defs/note"
          }
        }
      }
    },
    "paragraph": {
      "type": "object",
      "description": "A paragraph of text content",
      "required": ["text"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the paragraph"
        },
        "text": {
          "type": "string",
          "description": "The actual text content of the paragraph",
          "minLength": 1
        },
        "type": {
          "type": "string",
          "enum": ["normal", "quote", "footnote", "caption", "epigraph", "verse"],
          "description": "Type or style of the paragraph",
          "default": "normal"
        },
        "pageNumber": {
          "type": "integer",
          "description": "Page number where this paragraph appears",
          "minimum": 1
        },
        "confidence": {
          "type": "number",
          "description": "OCR confidence score for this paragraph (0-1)",
          "minimum": 0,
          "maximum": 1
        },
        "language": {
          "type": "string",
          "description": "Language of this paragraph if different from book language",
          "pattern": "^[a-z]{2}$"
        },
        "formatting": {
          "type": "object",
          "description": "Text formatting information",
          "properties": {
            "bold": {
              "type": "boolean",
              "description": "Whether text is bold"
            },
            "italic": {
              "type": "boolean",
              "description": "Whether text is italic"
            },
            "underline": {
              "type": "boolean",
              "description": "Whether text is underlined"
            },
            "fontSize": {
              "type": "string",
              "description": "Relative font size (small, normal, large, etc.)"
            },
            "alignment": {
              "type": "string",
              "enum": ["left", "center", "right", "justify"],
              "description": "Text alignment"
            }
          }
        },
        "notes": {
          "type": "array",
          "description": "Notes or annotations attached to this paragraph",
          "items": {
            "$ref": "#/$defs/note"
          }
        }
      }
    },
    "note": {
      "type": "object",
      "description": "A note, annotation, or comment",
      "required": ["content"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the note"
        },
        "type": {
          "type": "string",
          "enum": ["footnote", "endnote", "marginal", "editorial", "translator", "annotation"],
          "description": "Type of note",
          "default": "annotation"
        },
        "content": {
          "type": "string",
          "description": "The text content of the note",
          "minLength": 1
        },
        "author": {
          "type": "string",
          "description": "Author of the note (for editorial or translator notes)"
        },
        "date": {
          "type": "string",
          "format": "date",
          "description": "Date when the note was created"
        },
        "reference": {
          "type": "object",
          "description": "Reference information for citations in notes",
          "properties": {
            "text": {
              "type": "string",
              "description": "The text being referenced"
            },
            "position": {
              "type": "object",
              "description": "Position of the reference in the original text",
              "properties": {
                "start": {
                  "type": "integer",
                  "minimum": 0
                },
                "end": {
                  "type": "integer",
                  "minimum": 0
                }
              }
            }
          }
        },
        "pageNumber": {
          "type": "integer",
          "description": "Page number where the note appears",
          "minimum": 1
        }
      }
    },
    "pageRange": {
      "type": "object",
      "description": "Page range information",
      "required": ["start"],
      "properties": {
        "start": {
          "type": "integer",
          "description": "Starting page number",
          "minimum": 1
        },
        "end": {
          "type": "integer",
          "description": "Ending page number",
          "minimum": 1
        }
      }
    }
  }
}